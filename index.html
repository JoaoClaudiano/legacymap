<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Legacy Map Pro</title>
    <style>
        body, html, #app { margin: 0; width: 100%; height: 100%; background: #0f172a; color: white; font-family: sans-serif; overflow: hidden; }
        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 10; background: rgba(30, 41, 59, 0.95); padding: 20px; border-radius: 12px; border: 1px solid #334155; backdrop-filter: blur(8px); width: 310px; }
        input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #475569; background: #1e293b; color: white; margin-bottom: 10px; box-sizing: border-box; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold; }
        .loading { display: flex; height: 100vh; justify-content: center; align-items: center; font-family: monospace; }
    </style>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/reactflow@11.10.1/dist/react-flow.standalone.am.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/reactflow@11.10.1/dist/style.css">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="app"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [ready, setReady] = useState(false);
            const [nodes, setNodes] = useState([]);
            const [edges, setEdges] = useState([]);
            const [url, setUrl] = useState('');

            useEffect(() => {
                // Debug para ver o que o ReactFlow injetou no window
                console.log("Objeto ReactFlow encontrado:", window.ReactFlow);
                
                if (window.ReactFlow) {
                    setReady(true);
                }
            }, []);

            if (!ready) return <div className="loading">Aguardando ReactFlow...</div>;

            // Mapeamento din√¢mico dos componentes
            const ReactFlow = window.ReactFlow.default || window.ReactFlow.ReactFlow || window.ReactFlow;
            const Background = window.ReactFlow.Background;
            const Controls = window.ReactFlow.Controls;

            const analyze = async () => {
                const match = url.match(/github\.com\/([^/]+)\/([^/]+)/);
                if (!match) return;
                const [_, owner, repo] = match;
                
                const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`).then(r => r.json());
                const files = res.tree.filter(f => f.path.endsWith('.js')).slice(0, 15);
                
                setNodes(files.map((f, i) => ({
                    id: f.path,
                    data: { label: f.path.split('/').pop() },
                    position: { x: i * 150, y: i * 50 },
                    style: { background: '#3b82f6', color: '#fff', padding: '10px', borderRadius: '5px' }
                })));
            };

            return (
                <div style={{ width: '100vw', height: '100vh' }}>
                    <div id="ui-layer">
                        <h3>üó∫Ô∏è Legacy Map</h3>
                        <input placeholder="URL do Github" value={url} onChange={e => setUrl(e.target.value)} />
                        <button onClick={analyze}>Mapear</button>
                        <p style={{fontSize: '10px'}}>Arquivos: {nodes.length}</p>
                    </div>
                    <ReactFlow nodes={nodes} edges={edges} fitView>
                        <Background />
                        <Controls />
                    </ReactFlow>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('app')).render(<App />);
    </script>
</body>
</html>
